/*
 * ctrl_voice.c
 *
 *  Created on: 2013-4-15
 *      Author: WLD-LuoWenjie
 */
#include "stm32f30x.h"
#include "common.h"
#include "pal.h"
#include "sensor.h"
#include "global.h"
#include "controls.h"

#ifdef CTRL_VOICE
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------

static CTRL_VOICE_INFO	g_sstCtrlVoiceInfo;

//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------

void ctrl_voice_thread(void);

//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
ErrorStatus ctrl_voice_init(void)
{
	g_sstCtrlVoiceInfo.bInitOK = false;
	g_sstCtrlVoiceInfo.bKeyDown = false;

	if(!ss_buzzer_init())
	{
		return ERROR;
	}

	ss_buzzer_set_tone(e_buzzer_tone_6);

	if(!ctrl_event_add_100ms_thread(ctrl_voice_thread))
		return ERROR;

	g_sstCtrlVoiceInfo.bInitOK = true;

	return SUCCESS;
}
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
// called every 100ms
void ctrl_voice_thread(void)
{
	static uint32_t su32Flag = 0;

	if(!g_sstCtrlVoiceInfo.bInitOK)
		return;

	if(g_sstCtrlVoiceInfo.bKeyDown)
	{
		if(0 == su32Flag)
			ss_buzzer_on();

		if(CTRL_VOICE_KEYDOWN_VOICE_DELAY <= su32Flag)
		{
			ss_buzzer_off();
			g_sstCtrlVoiceInfo.bKeyDown = false;
			su32Flag = 0;
		}
		else
		{
			su32Flag++;
		}
	}
}
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------
void ctrl_voice_key_down(void)
{
	g_sstCtrlVoiceInfo.bKeyDown = true;
}
//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------

#endif
